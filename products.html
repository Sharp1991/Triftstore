<div class="products">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="filters">
          <ul>
            <li class="active" data-filter="*">All Products</li>
            <li data-filter=".des">Featured</li>
            <li data-filter=".dev">Flash Deals</li>
            <li data-filter=".gra">Last Minute</li>
          </ul>
        </div>
      </div>
      <div class="col-md-12">
        <div class="filters-content">
          <div class="row grid" id="product-list">
            <!-- Products load dynamically -->
          </div>
        </div>
      </div>
      <div class="col-md-12 text-center">
        <ul class="pages" id="pagination">
          <!-- Page numbers generated here -->
        </ul>
      </div>
    </div>
  </div>
</div>

<style>
  /* Product card with fixed width and dynamic height */
  .product-item {
    width: 100%;
    max-width: 350px;
    margin: auto;
    border: 1px solid #eee;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background: #fff;
  }
  .product-item img {
    width: 100%;
    height: auto;
    object-fit: contain; /* keep original aspect ratio */
    display: block;
  }
  .pages {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 30px;
    margin-bottom: 50px;
    padding: 0;
  }
  .pages li { list-style: none; }
  .pages li a {
    display: inline-block;
    padding: 8px 14px;
    background: #f4f4f4;
    color: #333;
    border-radius: 6px;
    text-decoration: none;
    transition: background 0.3s;
  }
  .pages li a:hover, .pages li a.active {
    background: #ff6600;
    color: #fff;
  }
</style>

<script>
const sheetAPI = "https://api.sheetbest.com/sheets/463f1150-f334-4c7b-ab9c-6b71829d01f9";
let products = [];
let currentPage = 1;
const productsPerPage = 6;

function fetchProducts() {
  fetch(sheetAPI)
    .then(res => res.json())
    .then(data => {
      products = data;
      renderProducts(currentPage, "*");
    });
}

function renderProducts(page, filter) {
  const list = document.getElementById("product-list");
  list.innerHTML = "";

  let filtered = products.filter(
    p => filter === "*" || (p.category && p.category === filter.substring(1))
  );

  const start = (page - 1) * productsPerPage;
  const end = start + productsPerPage;
  const pageProducts = filtered.slice(start, end);

  pageProducts.forEach(p => {
    const div = document.createElement("div");
    div.className = "col-lg-4 col-md-4 all " + (p.category || "");
    
    // Make images slider even if single
    const imagesArray = p.images.split(","); // support multiple URLs separated by commas
    let sliderContent = '<div class="product-slider">';
    imagesArray.forEach(img => {
      sliderContent += `<img src="${img.trim()}" alt="${p.name}">`;
    });
    sliderContent += '</div>';

    div.innerHTML = `
      <div class="product-item">
        ${sliderContent}
        <div class="down-content">
          <h4>${p.name}</h4>
          <h6>â‚¹${p.price}</h6>
          <p>${p.description}</p>
          <a href="${p['whatsapp link']}" target="_blank" class="btn btn-success">Buy on WhatsApp</a>
        </div>
      </div>
    `;
    list.appendChild(div);
  });

  initSliders(); // initialize slick slider
  renderPagination(Math.ceil(filtered.length / productsPerPage));
}

function renderPagination(totalPages) {
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";
  for (let i = 1; i <= totalPages; i++) {
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.href = "#";
    a.textContent = i;
    if (i === currentPage) a.classList.add("active");
    a.addEventListener("click", e => {
      e.preventDefault();
      currentPage = i;
      renderProducts(currentPage, getActiveFilter());
    });
    li.appendChild(a);
    pagination.appendChild(li);
  }
}

function getActiveFilter() {
  return document.querySelector(".filters li.active").getAttribute("data-filter");
}

document.querySelectorAll(".filters li").forEach(li => {
  li.addEventListener("click", () => {
    document.querySelectorAll(".filters li").forEach(el => el.classList.remove("active"));
    li.classList.add("active");
    currentPage = 1;
    renderProducts(currentPage, getActiveFilter());
  });
});

// Initialize slider using slick.js
function initSliders() {
  $('.product-slider').not('.slick-initialized').slick({
    dots: true,
    arrows: true,
    infinite: true,
    slidesToShow: 1,
    slidesToScroll: 1
  });
}

fetchProducts();
</script>
